<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leçon Interactive | Boucle 'do...while' Arduino</title>
    
    <!-- Lien vers la feuille de style principale du site -->
    <link rel="stylesheet" href="../css/style.css">
    
    <!-- Styles spécifiques à CETTE page -->
    <style>
        .lesson-container { background-color: var(--bg-card); border: 1px solid var(--border-color); border-radius: 8px; padding: 1.5rem 2rem; text-align: left; }
        .tabs-nav { display: flex; flex-wrap: wrap; border-bottom: 1px solid var(--border-color); margin-bottom: 1.5rem; }
        .tab-button { padding: 0.8rem 1.2rem; cursor: pointer; background: none; border: none; color: var(--text-light); font-size: 1rem; font-weight: 500; border-bottom: 3px solid transparent; transition: all 0.3s ease; }
        .tab-button:hover { background-color: rgba(255, 255, 255, 0.05); }
        .tab-button.active { color: var(--accent-blue); border-bottom-color: var(--accent-blue); }
        pre { background-color: #1E293B; color: #E2E8F0; padding: 1rem; border-radius: 0.5rem; overflow-x: auto; font-family: 'Source Code Pro', monospace; border: 1px solid var(--border-color); margin: 1rem 0; }
        code { font-family: 'Source Code Pro', monospace; color: var(--accent-blue); background-color: rgba(0, 191, 255, 0.1); padding: 2px 5px; border-radius: 4px; }
        h3 { font-size: 1.5rem; margin-top: 1rem; margin-bottom: 0.5rem; color: var(--text-heading); }
        h4 { font-size: 1.2rem; margin-top: 1.5rem; margin-bottom: 0.5rem; color: var(--text-light); }
        p, ul { margin-bottom: 1rem; }
        ul { list-style-position: inside; }
        .interactive-demo { display: flex; align-items: center; gap: 1rem; margin: 1.5rem 0; }
        .lesson-input { background-color: var(--bg-dark); border: 1px solid var(--border-color); color: var(--text-light); padding: 0.5rem; border-radius: 5px; width: 80px; }
        .lesson-button { background-color: var(--accent-blue); color: var(--bg-dark); border: none; padding: 0.6rem 1.2rem; border-radius: 5px; cursor: pointer; font-weight: bold; transition: transform 0.2s ease; }
        .lesson-button:hover { transform: scale(1.05); }
        #while-log { background-color: #0F172A; color: #94A3B8; font-family: 'Source Code Pro', monospace; padding: 1rem; border-radius: 0.5rem; height: 250px; overflow-y: auto; border: 1px solid #334155; }
        #while-log p { margin: 0; padding: 2px 0; }
        #while-log p.success { color: #22C55E; }
        #while-log p.fail { color: #F87171; }
        #while-log p.info { color: #38BDF8; }
        #while-log p.iter { color: #FDE047; }
        .exercise-section { margin-top: 2rem; padding-top: 2rem; border-top: 1px solid var(--border-color); }
        .exercise-section:first-child { margin-top: 0; padding-top: 0; border-top: none; }
        .exercise-box { background-color: rgba(0,0,0,0.15); padding: 1.5rem; border-radius: 8px; }
        .quiz-option { display: block; width: 100%; text-align: left; padding: 0.8rem; margin-top: 0.5rem; background-color: var(--bg-card); border: 1px solid var(--border-color); color: var(--text-light); cursor: pointer; border-radius: 5px; transition: background-color 0.3s ease; }
        .quiz-option:hover:not(:disabled) { background-color: #3e4263; }
        .quiz-option:disabled { opacity: 0.7; cursor: not-allowed; }
        .quiz-feedback { margin-top: 1rem; font-weight: bold; }
    </style>
</head>
<body>

    <header>
        <h1>Leçon : La boucle <code>do...while</code> (Faire... Tant que)</h1>
        <p><a href="../programmation.html" class="back-link">&larr; Retour aux applications de programmation</a></p>
    </header>

    <main class="container">
        <div class="lesson-container">
            
            <div class="tabs-nav">
                <button class="tab-button active" onclick="openTab(event, 'definition')">1. Définition & Syntaxe</button>
                <button class="tab-button" onclick="openTab(event, 'demo')">2. Démo Interactive</button>
                <button class="tab-button" onclick="openTab(event, 'pieges')">3. Pièges & Erreurs</button>
                <button class="tab-button" onclick="openTab(event, 'exercices')">4. Exercices</button>
            </div>

            <div id="tab-content">
                
                <div id="definition" class="tab-panel">
                    <h3>Qu'est-ce qu'une Boucle <code>do...while</code> ?</h3>
                    <p>La boucle <code>do...while</code> est une variante de la boucle <code>while</code>. Sa grande particularité est que le bloc de code est <strong>toujours exécuté au moins une fois</strong>, car la condition n'est testée qu'<strong>à la fin</strong>.</p>
                    <p>C'est utile pour les situations où vous devez effectuer une action une première fois avant de décider si vous devez la répéter (par exemple, lire une valeur d'un capteur, puis la relire si elle n'est pas bonne).</p>
                    <p>Le fonctionnement : <strong>1. On exécute le code. 2. On teste la condition. 3. Si elle est vraie, on retourne à l'étape 1.</strong></p>
                    <h4>Syntaxe de <code>do...while</code></h4>
                    <pre><code>int valeur;
do {
  // Ce code s'exécute toujours au moins une fois
  valeur = analogRead(A0); // On lit une valeur
  Serial.println("Lecture en cours...");
  delay(50);
} while (valeur < 500); // ...et on recommence tant que la valeur est trop basse.

Serial.println("Seuil atteint !");</code></pre>
                </div>

                <div id="demo" class="tab-panel" style="display:none;">
                    <h3>Testez la logique <code>do...while</code> !</h3>
                    <p>Simulons une demande de mot de passe. Le programme doit demander le mot de passe au moins une fois, et continuer de demander tant qu'il est incorrect.</p>
                    <pre><code>const int PIN_CORRECT = 1234;
int pinEntre;
do {
  // Demander à l'utilisateur d'entrer un PIN
  pinEntre = [Votre PIN];
} while (pinEntre != PIN_CORRECT);</code></pre>
                    <div class="interactive-demo">
                         <label for="pin-input">PIN (le bon est 1234) :</label>
                         <input type="number" id="pin-input" class="lesson-input" placeholder="ex: 0000">
                         <button id="demo-button" onclick="runDoWhileDemo()" class="lesson-button">Valider</button>
                    </div>
                    <h4>Log d'exécution :</h4>
                    <div id="while-log"><p>La boucle `do` va s'exécuter. Entrez un PIN...</p></div>
                </div>
                
                <div id="pieges" class="tab-panel" style="display:none;">
                    <h3>Piège 1 : Oublier le <code>;</code> après la condition</h3>
                    <p>Contrairement aux boucles <code>for</code> et <code>while</code>, la syntaxe de <code>do...while</code> se termine obligatoirement par un point-virgule après la parenthèse du <code>while</code>.</p>
                    <pre><code>do {
  // ...
} while (condition); // <-- Ce point-virgule est OBLIGATOIRE !</code></pre>
                    
                    <h3>Piège 2 : Utiliser <code>do...while</code> au lieu de <code>while</code></h3>
                    <p>N'utilisez pas <code>do...while</code> si le code ne doit pas s'exécuter lorsque la condition est fausse au départ. Si vous voulez tester AVANT d'agir, utilisez <code>while</code>.</p>

                    <h3>Piège 3 : La Boucle Infinie</h3>
                    <p>Comme avec <code>while</code>, si la condition ne peut jamais devenir fausse, le programme sera bloqué. Assurez-vous que quelque chose à l'intérieur de la boucle puisse influencer la condition.</p>
                </div>

                <div id="exercices" class="tab-panel" style="display:none;">
                    <h3>Testez vos connaissances !</h3>
                    <section class="exercise-section">
                        <div class="exercise-box">
                            <h4>Exercice 1 : Exécution garantie</h4>
                            <p>Qu'affichera ce code ?</p>
                            <pre><code>int n = 5;
do {
  Serial.println("Test");
} while (n < 5);</code></pre>
                            <div id="quiz-options-1">
                                <button class="quiz-option" onclick="checkQuiz(1, 'A')">A) Rien du tout</button>
                                <button class="quiz-option" onclick="checkQuiz(1, 'B')">B) "Test" une seule fois</button>
                                <button class="quiz-option" onclick="checkQuiz(1, 'C')">C) "Test" en boucle infinie</button>
                            </div><div id="quiz-feedback-1" class="quiz-feedback"></div>
                        </div>
                    </section>
                    <section class="exercise-section">
                        <div class="exercise-box">
                            <h4>Exercice 2 : Nombre d'itérations</h4>
                            <p>Combien de fois "Hello" sera-t-il affiché ?</p>
                            <pre><code>int count = 0;
do {
  Serial.println("Hello");
  count++;
} while (count <= 2);</code></pre>
                            <div id="quiz-options-2">
                                <button class="quiz-option" onclick="checkQuiz(2, 'A')">A) 2 fois</button>
                                <button class="quiz-option" onclick="checkQuiz(2, 'B')">B) 3 fois</button>
                                <button class="quiz-option" onclick="checkQuiz(2, 'C')">C) 4 fois</button>
                            </div><div id="quiz-feedback-2" class="quiz-feedback"></div>
                        </div>
                    </section>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <p>&copy; 2025 - Profs CIEL / Lycée des métiers SULLY</p>
    </footer>

    <script>
        function openTab(event, tabName) {
            document.querySelectorAll('.tab-panel').forEach(p => p.style.display = 'none');
            document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
            document.getElementById(tabName).style.display = 'block';
            event.currentTarget.classList.add('active');
        }
        const logEl = document.getElementById('while-log');
        const inputEl = document.getElementById('pin-input');
        const PIN_CORRECT = 1234;
        function logMessage(message, type = '') { logEl.innerHTML += `<p class="${type}">${message}</p>`; logEl.scrollTop = logEl.scrollHeight; }
        
        function runDoWhileDemo() {
            logEl.innerHTML = '';
            const pinEntre = parseInt(inputEl.value);
            if (isNaN(pinEntre)) {
                logMessage("Erreur : Entrez un PIN numérique.", 'fail'); return;
            }
            logMessage("Exécution du bloc `do`...", "info");
            logMessage(`   PIN entré : ${pinEntre}`);
            logMessage("Vérification de la condition `while`...", "info");
            
            if (pinEntre != PIN_CORRECT) {
                logMessage(`   Test : (${pinEntre} != ${PIN_CORRECT}) -> VRAI.`, 'fail');
                logMessage("   La boucle va continuer. Entrez le bon PIN.", "iter");
            } else {
                logMessage(`   Test : (${pinEntre} != ${PIN_CORRECT}) -> FAUX.`, 'success');
                logMessage("   PIN Correct ! Fin de la boucle.", "success");
            }
        }
        const correctAnswers = {
            1: { val: 'B', correct: 'Correct ! Une boucle do...while s\'exécute toujours au moins une fois. La condition (5 < 5) est ensuite testée et s\'avère fausse, donc la boucle s\'arrête.', wrong: 'Incorrect. La caractéristique de do...while est de toujours exécuter le code une première fois avant de tester la condition.' },
            2: { val: 'B', correct: 'Correct ! La boucle s\'exécute pour count=0, count=1, et count=2. Quand count vaut 3, la condition (3 <= 2) est fausse. Cela fait 3 tours.', wrong: 'Incorrect. La condition "inférieur ou égal" fait que le tour pour la valeur 2 est également inclus.' }
        };
        function checkQuiz(quizNum, answer) {
            const feedbackEl = document.getElementById(`quiz-feedback-${quizNum}`);
            document.querySelectorAll(`#quiz-options-${quizNum} button`).forEach(b => b.disabled = true);
            const isCorrect = (answer === correctAnswers[quizNum].val);
            const data = correctAnswers[quizNum];
            feedbackEl.textContent = isCorrect ? data.correct : data.wrong;
            feedbackEl.style.color = isCorrect ? '#22C55E' : '#F87171';
        }
    </script>
</body>
</html>