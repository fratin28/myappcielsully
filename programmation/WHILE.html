<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apprendre la Boucle 'while' Arduino</title>
    <!-- Chargement de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Police Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Gris clair */
        }
        /* Style pour les blocs de code */
        pre {
            background-color: #1E293B; /* Bleu-gris foncé */
            color: #E2E8F0; /* Gris clair */
            padding: 1rem;
            border-radius: 0.5rem; /* Coins arrondis */
            overflow-x: auto;
            font-family: 'Courier New', Courier, monospace;
        }
        .tab-button {
            transition: all 0.3s ease;
        }
        /* Thème Indigo */
        .tab-button.active {
            background-color: #6366F1; /* Indigo */
            color: white;
            border-bottom-width: 4px;
            border-bottom-color: #4F46E5; /* Indigo plus foncé */
        }
        .tab-button:not(.active):hover {
            background-color: #e5e7eb; /* Gris léger au survol */
        }
        .quiz-option {
            transition: background-color 0.3s ease;
        }
        .quiz-option:not(:disabled):hover {
            background-color: #e0e7ff; /* Indigo très clair */
        }
        .quiz-option:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }
        /* Style pour les conteneurs d'exercices */
        .exercise-section {
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 1px solid #d1d5db; /* border-gray-300 */
        }
        .exercise-section:first-child {
            margin-top: 0;
            padding-top: 0;
            border-top: none;
        }
        /* Style pour le log interactif */
        #while-log {
            background-color: #0F172A; /* Bleu nuit */
            color: #94A3B8; /* Gris-bleu */
            font-family: 'Courier New', Courier, monospace;
            padding: 1rem;
            border-radius: 0.5rem;
            height: 250px;
            overflow-y: auto;
            border: 1px solid #334155;
        }
        #while-log p {
            margin: 0;
            padding: 2px 0;
        }
        #while-log p.success {
            color: #22C55E; /* Vert */
        }
        #while-log p.fail {
            color: #F87171; /* Rouge */
        }
        #while-log p.info {
            color: #38BDF8; /* Bleu clair */
        }
        #while-log p.result {
            color: #FDE047; /* Jaune */
            font-weight: bold;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-900 p-4 md:p-8">

    <div class="max-w-4xl mx-auto bg-white shadow-2xl rounded-lg overflow-hidden">
        
        <!-- En-tête -->
        <header class="bg-gradient-to-r from-indigo-500 to-indigo-600 text-white p-6">
            <h1 class="text-3xl font-bold">Comprendre la Boucle <code>while</code> Arduino</h1>
            <p class="mt-2 text-lg opacity-90">Répéter une action TANT QU'une condition est vraie.</p>
        </header>

        <!-- Contenu principal -->
        <main class="p-6 md:p-8">

            <!-- Section : Tabs interactives -->
            <div>
                <!-- Boutons des onglets -->
                <div class="flex flex-wrap border-b border-gray-300 mb-6">
                    <button class="tab-button active py-3 px-6 font-semibold text-gray-700" onclick="openTab(event, 'definition')">1. Définition & Syntaxe</button>
                    <button class="tab-button py-3 px-6 font-semibold text-gray-700" onclick="openTab(event, 'demo')">2. Démo Interactive</button>
                    <button class="tab-button py-3 px-6 font-semibold text-gray-700" onclick="openTab(event, 'usages')">3. Pièges & Cas d'usage</button>
                    <button class="tab-button py-3 px-6 font-semibold text-gray-700" onclick="openTab(event, 'exercices')">4. Exercices</button>
                </div>

                <!-- Contenu des onglets -->
                <div id="tab-content">
                    
                    <!-- Onglet 1: Définition & Syntaxe -->
                    <div id="definition" class="tab-panel">
                        <h3 class="text-xl font-semibold mb-4 text-indigo-600">Qu'est-ce qu'une Boucle <code>while</code> ?</h3>
                        <p class="mb-4">La boucle <code>while</code> ("Tant que") est la forme de boucle la plus fondamentale. C'est une structure de contrôle qui répète un bloc de code <strong class="font-semibold">tant qu'une condition spécifiée reste vraie</strong>.</p>
                        <p>Son principe clé est que la condition est <strong class="font-semibold">testée AVANT</strong> chaque exécution du bloc de code. Si la condition est fausse dès le début, la boucle ne s'exécutera jamais.</p>

                        <h4 class="font-semibold mt-6 mb-2">Syntaxe</h4>
                        <p>La syntaxe est très simple :</p>
                        <pre><code>while (condition) {
  // Bloc de code à répéter
  // ...
  // Il faut que quelque chose ici finisse
  // par rendre la condition fausse !
}</code></pre>

                        <h4 class="font-semibold mt-6 mb-2">Exemple : Compteur</h4>
                        <p>Le code suivant va compter de 0 à 4. Observez bien la ligne <code>i++</code>, elle est cruciale.</p>
                        <pre><code>int i = 0; // 1. Initialisation

while (i < 5) { // 2. Condition (testée avant chaque tour)
  Serial.println(i);
  i++; // 3. Modification (pour éviter une boucle infinie)
}
Serial.println("Fin");</code></pre>
                        <p class="mt-2">Résultat :</p>
                        <pre class="bg-gray-100 text-gray-800">0
1
2
3
4
Fin</pre>
                    </div>

                    <!-- Onglet 2: Démo Interactive -->
                    <div id="demo" class="tab-panel" style="display:none;">
                        <h3 class="text-xl font-semibold mb-4">Testez la boucle <code>while</code> !</h3>
                        <p class="mb-4">Nous allons simuler l'exemple du compteur (compter de 0 à 3). Observez comment la condition est testée avant chaque tour.</p>
                        
                        <pre class="mb-4"><code>int i = 0;
while (i < 3) {
  Serial.println(i);
  i++;
}</code></pre>

                        <button id="demo-button" onclick="runWhileDemo()" class="bg-indigo-500 text-white px-6 py-2 rounded-md hover:bg-indigo-600 mb-4 font-semibold">
                            Démarrer la simulation
                        </button>

                        <h4 class="font-semibold mb-2">Log d'exécution :</h4>
                        <div id="while-log">
                            <p class="text-gray-500">Cliquez sur 'Démarrer' pour lancer la simulation...</p>
                        </div>
                    </div>
                    
                    <!-- Onglet 3: Pièges & Cas d'usage -->
                    <div id="usages" class="tab-panel" style="display:none;">
                        <h3 class="text-xl font-semibold mb-4 text-indigo-600">Piège 1 : La Boucle Infinie</h3>
                        <p class="mb-4">C'est le piège le plus courant avec <code>while</code>. Si vous oubliez de modifier la variable de la condition, celle-ci reste vraie <strong class="font-semibold">pour toujours</strong>.</p>

                        <pre><code>int i = 0;
while (i < 5) {
  // OUPS ! On a oublié i++
  Serial.println("Cette ligne s'affichera à l'infini !");
  delay(500);
}
// Le programme est bloqué ici et n'ira jamais plus loin.</code></pre>
                        
                        <h3 class="text-xl font-semibold mb-4 mt-8 text-indigo-600">Cas d'usage 1 : Remplacer `delay()` (attendre une action)</h3>
                        <p class="mb-4">C'est l'une des utilisations les plus puissantes : attendre qu'un événement se produise (comme un appui sur un bouton) sans bloquer le reste du code de la même manière qu'un <code>delay()</code>.</p>
                        <p>C'est le code pour un montage en <strong class="font-semibold">pull-down</strong> (le bouton passe à HIGH quand il est pressé).</p>
                        <pre><code>// Attend TANT QUE le bouton est LOW (non pressé)
while (digitalRead(buttonPin) == LOW) {
  // Ne rien faire, juste attendre...
  // (on peut faire clignoter une LED ici)
}
// Le code continue ici SEULEMENT quand le bouton est HIGH (pressé)
Serial.println("Bouton pressé !");</code></pre>

                        <h3 class="text-xl font-semibold mb-4 mt-8 text-indigo-600">Cas d'usage 2 : Lire un capteur jusqu'à un seuil</h3>
                        <p class="mb-4">Vous voulez attendre que la lumière dans une pièce atteigne un certain seuil avant de continuer.</p>
                        <pre><code>int luminosite = 0;

// TANT QUE la valeur est sous 500
while (luminosite < 500) {
  // On re-mesure la luminosité
  luminosite = analogRead(A0); 
  delay(10); // Petit délai pour stabiliser
}
// Le code sort de la boucle
Serial.println("Il fait assez jour !");</code></pre>
                    </div>

                    <!-- Onglet 4: Exercices -->
                    <div id="exercices" class="tab-panel" style="display:none;">
                        <h3 class="text-xl font-semibold mb-4">Testez vos connaissances !</h3>
                        
                        <!-- Exercice 1 -->
                        <section class="exercise-section">
                            <h4 class="text-lg font-semibold text-indigo-600 mb-4">Exercice 1 : Combien de tours ?</h4>
                            <div class="bg-gray-50 p-6 rounded-lg">
                                <p class="text-lg font-semibold mb-4">Combien de fois le mot "Tour" sera affiché ?</p>
                                <pre class="mb-4"><code>int i = 0;
while (i < 3) {
  Serial.println("Tour");
  i++;
}</code></pre>
                                <div id="quiz-options-1" class="space-y-3">
                                    <button class="quiz-option w-full text-left p-3 border rounded-md" onclick="checkQuiz(1, 3)">A) 3 fois (pour i=0, 1, 2)</button>
                                    <button class="quiz-option w-full text-left p-3 border rounded-md" onclick="checkQuiz(1, 2)">B) 2 fois (pour i=0, 1)</button>
                                    <button class="quiz-option w-full text-left p-3 border rounded-md" onclick="checkQuiz(1, 4)">C) 4 fois (pour i=0, 1, 2, 3)</button>
                                </div>
                                <div id="quiz-feedback-1" class="mt-4 text-lg font-semibold"></div>
                            </div>
                        </section>

                        <!-- Exercice 2 -->
                        <section class="exercise-section">
                            <h4 class="text-lg font-semibold text-indigo-600 mb-4">Exercice 2 : La boucle infinie</h4>
                            <div class="bg-gray-50 p-6 rounded-lg">
                                <p class="text-lg font-semibold mb-4">Que va faire ce code ?</p>
                                <pre class="mb-4"><code>int i = 5;
while (i > 0) {
  Serial.println(i);
  // Oups, pas de i--
}</code></pre>
                                <div id="quiz-options-2" class="space-y-3">
                                    <button class="quiz-option w-full text-left p-3 border rounded-md" onclick="checkQuiz(2, 'A')">A) Il va afficher "5" à l'infini.</button>
                                    <button class="quiz-option w-full text-left p-3 border rounded-md" onclick="checkQuiz(2, 'B')">B) Il va compter de 5 à 1.</button>
                                    <button class="quiz-option w-full text-left p-3 border rounded-md" onclick="checkQuiz(2, 'C')">C) Il ne va rien afficher.</button>
                                </div>
                                <div id="quiz-feedback-2" class="mt-4 text-lg font-semibold"></div>
                            </div>
                        </section>

                        <!-- Exercice 3 -->
                        <section class="exercise-section">
                            <h4 class="text-lg font-semibold text-indigo-600 mb-4">Exercice 3 : Zéro tour</h4>
                            <div class="bg-gray-50 p-6 rounded-lg">
                                <p class="text-lg font-semibold mb-4">Combien de fois le mot "Test" sera affiché ?</p>
                                <pre class="mb-4"><code>int i = 5;
while (i < 5) {
  Serial.println("Test");
  i++;
}</code></pre>
                                <div id="quiz-options-3" class="space-y-3">
                                    <button class="quiz-option w-full text-left p-3 border rounded-md" onclick="checkQuiz(3, 1)">A) 1 fois</button>
                                    <button class="quiz-option w-full text-left p-3 border rounded-md" onclick="checkQuiz(3, 5)">B) 5 fois</button>
                                    <button class="quiz-option w-full text-left p-3 border rounded-md" onclick="checkQuiz(3, 0)">C) 0 fois</button>
                                </div>
                                <div id="quiz-feedback-3" class="mt-4 text-lg font-semibold"></div>
                            </div>
                        </section>

                        <!-- Exercice 4 -->
                        <section class="exercise-section">
                            <h4 class="text-lg font-semibold text-indigo-600 mb-4">Exercice 4 : Attendre un appui (Pull-down)</h4>
                            <div class="bg-gray-50 p-6 rounded-lg">
                                <p class="text-lg font-semibold mb-4">J'ai un bouton en PULL-DOWN. Je veux attendre qu'il soit <strong class="font-semibold">pressé</strong> (donc qu'il passe à HIGH). Quelle est la bonne condition ?</p>
                                <pre class="mb-4"><code>while ( ...? ... ) {
  // Attendre
}</code></pre>
                                <div id="quiz-options-4" class="space-y-3">
                                    <button class="quiz-option w-full text-left p-3 border rounded-md" onclick="checkQuiz(4, 'A')">A) <code>digitalRead(pin) == HIGH</code></button>
                                    <button class="quiz-option w-full text-left p-3 border rounded-md" onclick="checkQuiz(4, 'B')">B) <code>digitalRead(pin) == LOW</code></button>
                                    <button class="quiz-option w-full text-left p-3 border rounded-md" onclick="checkQuiz(4, 'C')">C) <code>analogRead(pin) < 100</code></button>
                                </div>
                                <div id="quiz-feedback-4" class="mt-4 text-lg font-semibold"></div>
                            </div>
                        </section>

                        <!-- Exercice 5 -->
                        <section class="exercise-section">
                            <h4 class="text-lg font-semibold text-indigo-600 mb-4">Exercice 5 : Valeur de sortie</h4>
                            <div class="bg-gray-50 p-6 rounded-lg">
                                <p class="text-lg font-semibold mb-4">Que vaut <code>i</code> APRÈS la fin de cette boucle ?</p>
                                <pre class="mb-4"><code>int i = 0;
while (i < 10) {
  i++;
}
Serial.println(i);</code></pre>
                                <div id="quiz-options-5" class="space-y-3">
                                    <button class="quiz-option w-full text-left p-3 border rounded-md" onclick="checkQuiz(5, 9)">A) 9</button>
                                    <button class="quiz-option w-full text-left p-3 border rounded-md" onclick="checkQuiz(5, 10)">B) 10</button>
                                    <button class="quiz-option w-full text-left p-3 border rounded-md" onclick="checkQuiz(5, 0)">C) 0</button>
                                </div>
                                <div id="quiz-feedback-5" class="mt-4 text-lg font-semibold"></div>
                            </div>
                        </section>

                    </div>

                </div>
            </div>

        </main>
    </div>

    <!-- Script JavaScript -->
    <script>
        // Logique des onglets
        function openTab(event, tabName) {
            const tabPanels = document.querySelectorAll('.tab-panel');
            tabPanels.forEach(panel => panel.style.display = 'none');

            const tabButtons = document.querySelectorAll('.tab-button');
            tabButtons.forEach(button => button.classList.remove('active', 'text-gray-700'));

            document.getElementById(tabName).style.display = 'block';
            event.currentTarget.classList.add('active');
        }

        // Logique de la Démo Interactive
        const logEl = document.getElementById('while-log');
        const demoButton = document.getElementById('demo-button'); // Référence au bouton

        function logMessage(message, type = '') {
            logEl.innerHTML += `<p class="${type}">${message}</p>`;
            logEl.scrollTop = logEl.scrollHeight; // Auto-scroll
        }

        // Helper function for delay
        const delay = ms => new Promise(res => setTimeout(res, ms));

        async function runWhileDemo() {
            logEl.innerHTML = ''; // Nettoyer le log
            demoButton.disabled = true;
            demoButton.textContent = "Simulation en cours...";
            
            logMessage(`Simulation démarrée.`, 'info');
            await delay(500);
            
            logMessage(`Initialisation : int i = 0;`);
            let i = 0;
            await delay(800);

            while (true) {
                logMessage(`Test Condition : (i < 3) ? (${i} < 3)`);
                await delay(800);

                if (!(i < 3)) {
                    logMessage(`   -> Condition FAUSSE.`, 'fail');
                    break; // Sortir de la boucle while(true) de simulation
                }
                
                logMessage(`   -> Condition VRAIE.`, 'success');
                await delay(500);
                logMessage(`   -> Exécution bloc : Serial.println(${i})`);
                await delay(500);
                logMessage(`   -> Résultat : ${i}`, 'result');
                await delay(800);
                
                logMessage(`   -> Exécution bloc : i++`);
                i++;
                logMessage(`   -> i vaut maintenant ${i}.`);
                await delay(1000);
            }
            
            logMessage(`Sortie de la boucle.`, 'info');

            demoButton.disabled = false;
            demoButton.textContent = "Démarrer la simulation";
        }


        // --- Logique des Exercices ---
        const correctAnswers = {
            1: { val: 3, correct: 'Correct ! La boucle s\'exécute pour i=0, i=1, et i=2. À i=3, la condition (3 < 3) est fausse.', wrong: 'Incorrect. La boucle tourne 3 fois : i=0, i=1, i=2. (3 < 3) est faux.' },
            2: { val: 'A', correct: 'Correct ! La variable i vaut 5 et ne change jamais. La condition (5 > 0) est toujours vraie.', wrong: 'Incorrect. La variable i ne change jamais, la condition reste toujours vraie.' },
            3: { val: 0, correct: 'Correct ! La condition (5 < 5) est fausse dès le début. La boucle ne s\'exécute jamais.', wrong: 'Incorrect. La condition est testée AVANT. (5 < 5) est faux, donc la boucle est sautée.' },
            4: { val: 'B', correct: 'Correct ! On attend TANT QUE le bouton est LOW (au repos). On sort quand il passe HIGH.', wrong: 'Incorrect. On veut attendre TANT QUE le bouton est au repos (LOW en pull-down).' },
            5: { val: 10, correct: 'Correct ! La boucle s\'arrête quand i=10 (car 10 < 10 est faux). La valeur de i est donc 10.', wrong: 'Incorrect. La boucle s\'exécute pour i=9 (9<10), i++ (i=10). Test: (10<10) -> Faux. On sort. i vaut 10.' }
        };

        function checkQuiz(quizNumber, selectedAnswer) {
            const feedbackEl = document.getElementById(`quiz-feedback-${quizNumber}`);
            const optionsEl = document.getElementById(`quiz-options-${quizNumber}`);
            
            optionsEl.querySelectorAll('button').forEach(button => button.disabled = true);

            const quizData = correctAnswers[quizNumber];
            if (selectedAnswer === quizData.val) {
                feedbackEl.textContent = quizData.correct;
                feedbackEl.style.color = 'green';
            } else {
                feedbackEl.textContent = quizData.wrong;
                feedbackEl.style.color = 'red';
            }
        }
    </script>
</body>
</html>